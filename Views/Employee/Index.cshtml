@model IEnumerable<Practical_13.Models.Employee>
@{
    ViewData["Title"] = "Index";
}

<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />

<h1>Index</h1>
<div class="container">
    <div class="row">
        <div class="col">
            <button class="btn btn-primary" id="showColumnsBtn" syle="display:block">Show Columns</button>
            <button class="btn btn-primary" id="hideColumnsBtn" style="display:none">Hide Columns</button>
        </div>
        <div class="col d-flex justify-content-end">
            <button class="btn btn-primary" id="loadDataBtn">Filter</button>
        </div>
    </div>
</div>

<br />
<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table" id="employeeTable" style="display: none;">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.FirstName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MiddleName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LastName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DOB)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MobileNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Address)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Salary)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DesignationDetail)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.FirstName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.MiddleName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.LastName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DOB)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.MobileNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Address)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Salary)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DesignationDetail.Designation)
                </td>
                <td>
                    <a asp-action="Edit" class="btn btn-warning" asp-route-id="@item.Id">Edit</a> &nbsp;
                    <a asp-action="Details" class="btn btn-secondary" asp-route-id="@item.Id">Details</a> &nbsp;
                    <button type="submit" class="btn btn-danger" id="deleteBtn">Delete</button>
                    <input id="getId" type="hidden" value="@item.Id" />
                </td>
            </tr>
        }
    </tbody>
</table>

<div id="partialViewContainer"></div>
<table id="dataTable" style="display:none" class="table table-bordered">
    <thead>
        <tr>
            <th scope="col">Designation Name</th>
            <th scope="col">Count</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

@section scripts {
    <script>
        document.getElementById("showColumnsBtn").addEventListener("click", function () {
            console.log("Show")
            document.getElementById("employeeTable").style.display = "table";
            document.getElementById("showColumnsBtn").style.display = "none";
            document.getElementById("hideColumnsBtn").style.display = "block";
        });
        document.getElementById("hideColumnsBtn").addEventListener("click", function () {
            console.log("Hide")
            document.getElementById("showColumnsBtn").style.display = "block";
            document.getElementById("hideColumnsBtn").style.display = "none";
            document.getElementById("employeeTable").style.display = "none";
        });
        $('#loadDataBtn').click(function () {
            $("#dataTable").css("display", "table")
            $.ajax({
                url: '/Employee/GetCount',
                type: 'GET',
                success: function (data) {
                    $('#dataTable tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        var row = '<tr>' +
                            '<td>' + data[i].departmentName + '</td>' +
                            '<td>' + data[i].totalEmployees + '</td>' +
                            '</tr>';
                        $('#dataTable tbody').append(row);
                    }
                },
                error: function () {
                    alert('Error occurred while loading partial view.');
                }
            });
        });
        document.getElementById("deleteBtn").addEventListener("click", function(){
            var id = document.getElementById("getId");
            var itemId = id.value;
            var result = window.confirm("Are you sure you want to delete this item?");
            if (result) {
                window.location.href = '@Url.Action("Delete", "Employee")' + '?id=' + itemId;
            } else {
                window.location.href = '@Url.Action("Index", "Employee")';
            }
        })       
    </script>
}